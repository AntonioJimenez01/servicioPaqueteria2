<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cliente">
    

    <select id="obtenerClientes" resultType="pojo.Cliente">
        SELECT
            c.idCliente,
            c.nombre, 
            c.apellidoPaterno, 
            c.apellidoMaterno, 
            c.telefono, 
            c.correo
        FROM cliente c
    </select>
    
    <select id="obtenerDireccionesPorCliente" resultType="pojo.Direccion">
        SELECT 
            d.idDireccion,
            d.tipo,
            d.calle,
            d.numero,
            d.colonia,
            d.codigoPostal
        FROM direccion d
        WHERE d.idCliente = #{idCliente}
    </select>


    <select id= "idCliente" resultType="pojo.Cliente">
        SELECT idCliente FROM cliente WHERE idCliente = #{idCliente}
    </select>
    
    <insert id="insertarCliente" parameterType="pojo.Cliente" useGeneratedKeys="true" keyProperty="idCliente">
        INSERT INTO cliente (nombre, apellidoPaterno, apellidoMaterno, telefono, correo)
        VALUES (#{nombre}, #{apellidoPaterno}, #{apellidoMaterno}, #{telefono}, #{correo})
    </insert>

    <insert id="insertarDireccion" parameterType="pojo.Direccion">
        INSERT INTO direccion (idCliente, tipo, calle, numero, colonia, codigoPostal)
        VALUES (#{idCliente}, 'cliente', #{calle}, #{numero}, #{colonia}, #{codigoPostal})
    </insert>
    
    <update id="actualizarCliente" parameterType="pojo.Cliente">
        UPDATE cliente
        SET nombre = #{nombre}, apellidoPaterno = #{apellidoPaterno}, apellidoMaterno = #{apellidoMaterno}, 
            telefono = #{telefono}, correo = #{correo}
        WHERE idCliente = #{idCliente}
    </update>
    
    <update id="actualizarDireccion" parameterType="pojo.Direccion">
       UPDATE direccion
        SET calle = #{calle}, numero = #{numero}, colonia = #{colonia}, 
        codigoPostal = #{codigoPostal}
       WHERE idDireccion = #{idDireccion}
    </update>

<!-- Eliminar direcciones asociadas al cliente -->
<delete id="eliminarDirecciones" parameterType="int">
    DELETE FROM direccion WHERE idCliente = #{idCliente};
</delete>

<!-- Eliminar el cliente -->
<delete id="eliminarCliente" parameterType="int">
    DELETE FROM cliente WHERE idCliente = #{idCliente};
</delete>


<select id="buscarCliente" parameterType="map" resultType="pojo.Cliente">
    SELECT 
        c.idCliente, c.nombre, c.apellidoPaterno, c.apellidoMaterno, c.telefono, c.correo
    FROM cliente c
       WHERE
        (#{nombre} IS NULL OR c.nombre LIKE CONCAT('%', #{nombre}, '%'))
        AND (#{telefono} IS NULL OR c.telefono LIKE CONCAT('%', #{telefono}, '%'))
        AND (#{correo} IS NULL OR c.correo LIKE CONCAT('%', #{correo}, '%'))
</select>

</mapper>
